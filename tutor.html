<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student-Tutor Connect System</title>
    <link rel="stylesheet" href="./assets/style.css">
    <script src="https://kit.fontawesome.com/e7df210b8c.js" crossorigin="anonymous"></script>
    <style>
      .nb:hover{
    transform: scale(1.1);
    }
    </style>
</head>
<body>
      <nav class="navbar">
        <a href="index.html" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80px" width="auto"></a>
        <div class="nav">
            <ul class="list">
            <li><a href="aboutus.html" class="nb">About us</a></li>
            <li><a href="tutor.html" class="nb">Find a tutor</a></li>
            <li><a href="becomeTutor.html" class="nb">Become a tutor</a></li>
             <div class="search-bar"> 
            <input type="text" class="searchInput" placeholder="Search tutors..." id="navSearch"> 
            <button class="clickHere" id="navSearchBtn"><i class="fa-solid fa-magnifying-glass"></i></button>
        </div>
            <li><a href="login.html"><button type="button">Login</button></a></li>
            <li><a href="register.html"><button type="button">Sign up</button></a></li>
            </ul>
        </div>
    </nav>

    <div class="t-container">
        <div class="text" style="display: flex;flex-direction: column; gap: 40px;">
        <h1>Find your perfect tutor.</h1>
        <h3>Enter your requirements and let our system choose <span>your perfect tutor.</span> <br> Or choose yourself one from our perfect candidates. </h3>
        </div>
        <img src="./assets/images/choose.png" alt="choose" height="270px" width="400px">
    </div>

    <div class="find-tutor">
      <h1>Sign up and find the tutor as per your requirements.</h1>
      <h3>Follow three simple steps and let us find the tutor that meets all your requirements in your budget and time.</h3>
      <div class="finding-steps">
        
        <div class="find-card">
          <img src="./assets/images/signup.png" alt="">
          <h3>Sign up</h3>
        </div>

        <div class="find-card">
          <img src="./assets/images/requirements.png" alt="">
          <h3>Fill in your requirements</h3>
        </div>

        <div class="find-card">
          <img src="./assets/images/search.png" alt="">
          <h3>Let us find you the perfect tutor</h3>
        </div>
      </div>
    </div>

    <div class="level-up">
      <h2>Take your study session to another level with the tutors who excel their respective field.</h2>
      <img src="./assets/images/levelup.png" alt="">
      <h1>Hurry up and register now</h1>
      <button><a href="./register.html">Register Now</a></button>
    </div>
    

</body>
<footer>
        <h3>Quick links</h3>
        <div class="ftr">
        <ul>
            <li><a href="./aboutus.html">About us</a></li>
            <li><a href="./faqs.html">FAQs</a></li>
            <li><a href="tutor.html">Find a tutor</a></li>
            <li><a href="becomeTutor.html">Become a tutor</a></li>
            <li><a href="./terms.html">Terms and Conditions</a></li>  
        </ul>
        <div class="contacts">
            <p><i class="fa-solid fa-envelope"></i> : student.connect.tutor@email.com</p>
            <p><i class="fa-solid fa-phone"></i> : 987654321</p>
            <span>
            <p><a href="www.facebook.com"><i class="fa-brands fa-facebook"></i></a></p>
            <p><a href="www.twitter.com"><i class="fa-brands fa-x-twitter"></i></a></p>
            <p><a href="www.instagram.com"><i class="fa-brands fa-instagram"></i></a></p>
            <p><a href="www.linkedin.com"><i class="fa-brands fa-linkedin"></i></a></p>
            </span>
        </div>
        <div class="start" style="width: 200px;">
               <button class="login"><a href="./register.html">Register now</a></button>
            <button class="login"><a href="./login.html">Log in</a></button>  
        </div>
        <img src="./assets/images/pill-logo.png" alt="Logo" height="100px">
        </div>
    </footer>
<script>
    const provinceDistricts = {
  "Koshi": ["Bhojpur", "Dhankuta", "Ilam", "Jhapa", "Morang", "Sankhuwasabha", "Sunsari", "Taplejung", "Tehrathum", "Udayapur"],
  "Madhesh": ["Bara", "Dhanusha", "Mahottari", "Parsa", "Rautahat", "Saptari", "Sarlahi", "Siraha"],
  "Bagmati": ["Bhaktapur", "Chitwan", "Dhading", "Dolakha", "Kathmandu", "Kavrepalanchok", "Lalitpur", "Makwanpur", "Nuwakot", "Ramechhap", "Rasuwa", "Sindhuli", "Sindhupalchok"],
  "Gandaki": ["Baglung", "Gorkha", "Kaski", "Lamjung", "Manang", "Mustang", "Myagdi", "Nawalpur", "Parbat", "Syangja", "Tanahun"],
  "Lumbini": ["Arghakhanchi", "Banke", "Bardiya", "Dang", "Eastern Rukum", "Gulmi", "Kapilvastu", "Palpa", "Parasi", "Pyuthan", "Rolpa", "Rupandehi", "Western Rukum"],
  "Karnali": ["Dailekh", "Dolpa", "Humla", "Jajarkot", "Jumla", "Kalikot", "Mugu", "Salyan", "Surkhet"],
  "Sudurpashchim": ["Achham", "Baitadi", "Bajhang", "Bajura", "Dadeldhura", "Darchula", "Doti", "Kailali", "Kanchanpur"]
};

const provinceSelect = document.getElementById("proviences");
provinceSelect.innerHTML = '<option value="">Select Province</option>';
Object.keys(provinceDistricts).forEach(province => {
  const option = document.createElement("option");
  option.value = province;
  option.textContent = province;
  provinceSelect.appendChild(option);
});

provinceSelect.addEventListener('change', function() {
  const districtSelect = document.getElementById("districts");
  districtSelect.innerHTML = '<option value="">Select District</option>';
  
  if (this.value) {
    provinceDistricts[this.value].forEach(district => {
      const option = document.createElement("option");
      option.value = district;
      option.textContent = district;
      districtSelect.appendChild(option);
    });
  }
});

    // Fetch verified tutors from API
  let tutors = [];
  
  async function loadTutors() {
    try {
      const response = await fetch('http://localhost:5000/api/tutor/verified');
      const data = await response.json();
      
      if (response.ok && data.tutors) {
        tutors = data.tutors.map(tutor => ({
          id: tutor.tutor_id,
          name: tutor.name || tutor.full_name || 'Unknown',
          image: tutor.profile_picture || './assets/images/default-profile.png',
          level: tutor.education_level || 'N/A',
          subject: tutor.subject || 'N/A',
          availability: tutor.is_available ? 'Available' : 'Not Available',
          mode: tutor.teaching_mode ? tutor.teaching_mode.toLowerCase() : 'N/A',
          district: tutor.location || 'N/A',
          province: 'N/A',
          price: getPriceCategory(tutor.hourly_rate),
          rate: `Rs. ${tutor.hourly_rate || 'N/A'}/hr`,
          experience: `${tutor.experience_years || 0} years`,
          bio: `Verified tutor specializing in ${tutor.subject || 'their subject'} with ${tutor.experience_years || 0} years of experience.`
        }));
      } else {
        console.error('Failed to load tutors:', data.error);
        tutors = [];
      }
    } catch (error) {
      console.error('Error loading tutors:', error);
      tutors = [];
    }
    
    renderTutors(tutors);
  }
  
  function getPriceCategory(rate) {
    if (!rate) return 'medium';
    if (rate < 500) return 'low';
    if (rate < 1000) return 'medium';
    if (rate < 1500) return 'high';
    return 'veryHigh';
  }
  
  // Initialize tutors on page load
  loadTutors();
  
  // Old mock data removed - now using API

// Function to render tutors
function renderTutors(tutorsToShow) {
  const container = document.getElementById('tutor-cards');
  if (!container) {
    console.error("Container element not found");
    return;
  }
  
  if (!tutorsToShow.length) {
    container.innerHTML = '<p>No tutors found matching your criteria.</p>';
    return;
  }

  container.innerHTML = tutorsToShow.map(tutor => `
    <div class="tcard">
      <img src="${tutor.image}" alt="${tutor.name}" onerror="this.src='./assets/default-profile.png'">
      <h2>${tutor.name}</h2>
      <p><b>Level:</b> ${tutor.level}</p>
      <p><b>Subject:</b> ${tutor.subject}</p>
      <p><b>District:</b> ${tutor.district}</p>
      <p><b>Province:</b> ${tutor.province}</p>
      <p><b>Mode:</b> ${tutor.mode.charAt(0).toUpperCase() + tutor.mode.slice(1)}</p>
      <p><b>Rate:</b> ${tutor.rate}</p>
      <p>${tutor.bio}</p>
      <button class="show-more-btn" data-id="${tutor.id}">Show More</button>
    </div>
  `).join('');

  // Add event listeners AFTER the elements exist in the DOM
  document.querySelectorAll('.show-more-btn').forEach(btn => {
    btn.addEventListener('click', function() {
      const tutorId = this.getAttribute('data-id');
      handleShowMore(tutorId);
    });
  });
}

// Create modal if it doesn't exist
function ensureModalExists() {
  if (!document.getElementById('tutor-modal')) {
    const modalDiv = document.createElement('div');
    modalDiv.id = 'tutor-modal';
    modalDiv.style.display = 'none';
    modalDiv.style.position = 'fixed';
    modalDiv.style.top = '0';
    modalDiv.style.left = '0';
    modalDiv.style.width = '100vw';
    modalDiv.style.height = '100vh';
    modalDiv.style.background = 'rgba(0,0,0,0.5)';
    modalDiv.style.justifyContent = 'center';
    modalDiv.style.alignItems = 'center';
    modalDiv.style.zIndex = '1000';
    modalDiv.innerHTML = `
      <div id="modal-content" style="background:#fff; padding:30px; border-radius:10px; max-width:400px; margin:auto; position:relative;">
        <button id="close-modal" style="position:absolute; top:10px; right:10px;">&times;</button>
        <div id="modal-body"></div>
      </div>
    `;
    document.body.appendChild(modalDiv);
    document.getElementById('close-modal').onclick = function() {
      document.getElementById('tutor-modal').style.display = 'none';
    };
  }
}

// Handle show more button click
function handleShowMore(tutorId) {
  if (localStorage.getItem('loggedIn') !== 'true') {
    window.location.href = 'login.html';
    return;
  }
  
  const tutor = tutors.find(t => t.id == tutorId);
  if (!tutor) return;

  const modal = document.getElementById('tutor-modal');
  const modalBody = document.getElementById('modal-body');
  modalBody.innerHTML = `
    <h2>${tutor.name}</h2>
    <img src="${tutor.image}" alt="${tutor.name}" style="width:120px;height:120px;">
    <p><b>Level:</b> ${tutor.level}</p>
    <p><b>Subject:</b> ${tutor.subject}</p>
    <p><b>District:</b> ${tutor.district}</p>
    <p><b>Province:</b> ${tutor.province}</p>
    <p><b>Mode:</b> ${tutor.mode.charAt(0).toUpperCase() + tutor.mode.slice(1)}</p>
    <p><b>Rate:</b> ${tutor.rate}</p>
    <p><b>Experience:</b> ${tutor.experience}</p>
    <p><b>Bio:</b> ${tutor.bio}</p>
  `;
  modal.style.display = 'flex';
}

// Filter function
function filterTutors() {
  const level = document.getElementById('level').value;
  const subject = document.getElementById('subject').value;
  const district = document.getElementById('districts').value;
  const province = document.getElementById('proviences').value;
  const mode = document.querySelector('input[name="mode"]:checked')?.value;
  const searchText = document.querySelector('.searchInput').value.toLowerCase();
  const priceSort = document.getElementById('price').value;

  let filtered = tutors.filter(tutor => {
    return (!level || tutor.level === level) &&
           (!subject || tutor.subject === subject) &&
           (!district || tutor.district === district) &&
           (!province || tutor.province === province) &&
           (!mode || tutor.mode === mode) &&
           (!searchText || 
             tutor.name.toLowerCase().includes(searchText) ||
             tutor.subject.toLowerCase().includes(searchText) ||
             tutor.bio.toLowerCase().includes(searchText));
  });

  if (priceSort === 'low' || priceSort === 'high') {
    filtered.sort((a, b) => {
      const aPrice = parseInt(a.rate.replace(/\D/g, ''));
      const bPrice = parseInt(b.rate.replace(/\D/g, ''));
      return priceSort === 'low' ? aPrice - bPrice : bPrice - aPrice;
    });
  }

  renderTutors(filtered);
}

// Initialize everything when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
  ensureModalExists();
  
  if (!document.getElementById('tutor-cards')) {
    console.error("Element with ID 'tutor-cards' not found");
    return;
  }

  // Tutors will be loaded by loadTutors() function

  document.querySelectorAll('select, input[type="radio"]').forEach(el => {
    el.addEventListener('change', filterTutors);
  });
  
  document.querySelector('.searchInput').addEventListener('input', filterTutors);
  
  document.querySelector('.clear').addEventListener('click', function() {
    document.getElementById('level').value = '';
    document.getElementById('subject').value = '';
    document.getElementById('districts').innerHTML = '<option value="">Select District</option>';
    document.getElementById('proviences').value = '';
    document.querySelectorAll('input[name="mode"]').forEach(r => r.checked = false);
    document.getElementById('price').value = '';
    document.querySelector('.searchInput').value = '';
    renderTutors(tutors);
  });
});


const searchInput = document.getElementById("search");
searchInput.addEventListener('input', () => {
  const searchItem = searchInput.value.toLowerCase();
  const filtered = tutors.filter(tutor => 
    tutor.name.toLowerCase().includes(searchItem)
  );
   renderTutors(filtered);
})

// Navbar search functionality
document.getElementById('navSearchBtn').addEventListener('click', function() {
	var query = document.getElementById('navSearch').value.trim();
	if (query) {
		document.getElementById('search').value = query;
		searchInput.dispatchEvent(new Event('input'));
	}
});
document.getElementById('navSearch').addEventListener('keypress', function(e) {
	if (e.key === 'Enter') {
		document.getElementById('navSearchBtn').click();
	}
});

// Handle URL search parameter
const urlParams = new URLSearchParams(window.location.search);
const searchParam = urlParams.get('search');
if (searchParam) {
	document.getElementById('search').value = searchParam;
	searchInput.dispatchEvent(new Event('input'));
}
</script>
</html>