<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./assets/style.css">
	<title>Verified Tutors</title>
	<style>
		.dashboard-container {
			padding-top: 100px;
			min-height: 100vh;
			background-color: var(--body);
		}

		.dashboard-nav {
			background: linear-gradient(135deg, var(--slider) 0%, var(--accent) 100%);
			padding: 1.5rem 2rem;
			color: white;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}

		.dashboard-nav h2 {
			margin: 0;
			font-size: 1.5rem;
			font-weight: 600;
		}

		.dashboard-nav .user-info {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.dashboard-nav .username {
			font-size: 1.1rem;
			font-weight: 500;
		}

		.dashboard-nav ul {
			list-style: none;
			display: flex;
			gap: 2rem;
			align-items: center;
			margin: 0;
			padding: 0;
		}

		.dashboard-nav ul li a {
			color: white;
			text-decoration: none;
			font-size: 1.1rem;
			padding: 0.5rem 1rem;
			border-radius: 6px;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.dashboard-nav ul li a:hover {
			background-color: rgba(255,255,255,0.2);
			transform: translateY(-2px);
		}

		.sign-out-btn {
			background-color: #dc3545;
			padding: 0.6rem 1.2rem;
			border-radius: 6px;
			border: none;
			color: white;
			cursor: pointer;
			font-size: 1rem;
			transition: all 0.3s ease;
		}

		.sign-out-btn:hover {
			background-color: #c82333;
			transform: translateY(-2px);
		}

		.dashboard-content {
			padding: 2rem;
			max-width: 1200px;
			margin: 0 auto;
		}

		.welcome-section {
			background: white;
			padding: 2rem;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			margin-bottom: 2rem;
		}

		.welcome-section h1 {
			color: var(--accent);
			font-size: 2rem;
			margin-bottom: 0.5rem;
		}

		.welcome-section p {
			color: #666;
			font-size: 1.1rem;
		}

		.container {
			max-width: 1400px;
			margin: 100px auto 40px;
			padding: 20px;
			display: flex;
			flex-direction: column;
		}
		.header {
			background: white;
			padding: 30px;
			border-radius: 12px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
			margin-bottom: 30px;
		}
		.header h1 {
			color: var(--logo);
			margin-bottom: 10px;
		}
		.header p {
			color: #666;
			font-size: 1.1rem;
		}
		.tutors-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
			gap: 25px;
		}
		.tutor-card {
			background: white;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			overflow: hidden;
			transition: all 0.3s ease;
			cursor: pointer;
		}
		.tutor-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 8px 20px rgba(0,0,0,0.15);
		}
		.tutor-header {
			background: linear-gradient(135deg, var(--logo) 0%, #4a90e2 100%);
			padding: 20px;
			color: white;
		}
		.tutor-header h3 {
			margin: 0 0 5px 0;
			font-size: 1.3rem;
		}
		.tutor-header .subject {
			opacity: 0.9;
			font-size: 0.95rem;
		}
		.verified-badge {
			display: inline-block;
			background: rgba(255,255,255,0.3);
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 0.85rem;
			margin-top: 8px;
		}
		.tutor-body {
			padding: 20px;
		}
		.info-row {
			display: flex;
			justify-content: space-between;
			padding: 12px 0;
			border-bottom: 1px solid #f0f0f0;
		}
		.info-row:last-child {
			border-bottom: none;
		}
		.info-label {
			color: #888;
			font-weight: 600;
			font-size: 0.95rem;
		}
		.info-value {
			color: #333;
			font-weight: 500;
			text-align: right;
		}
		.rate-highlight {
			color: var(--logo);
			font-size: 1.2rem;
			font-weight: bold;
		}
		.availability {
			display: inline-block;
			padding: 5px 12px;
			border-radius: 15px;
			font-size: 0.85rem;
			font-weight: 600;
		}
		.availability.available {
			background: #d1e7dd;
			color: #0f5132;
		}
		.availability.unavailable {
			background: #f8d7da;
			color: #842029;
		}
		.loading {
			text-align: center;
			padding: 40px;
			color: #666;
		}
		.empty-state {
			text-align: center;
			padding: 60px 20px;
			background: white;
			border-radius: 12px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.1);
		}
		.empty-state h3 {
			color: #666;
			margin-bottom: 10px;
		}
	</style>
</head>
<body>
	<div class="dashboard-nav">
		<a href="#" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80px" width="auto"></a>
        
		<div class="user-info">
			<span class="username" id="displayName">Student</span>
			<ul>
				<li><a href="./verified-tutors.html"><i class="fas fa-search"></i> Find Tutor</a></li>
				<li><a href="#notifications" onclick="showNotifications()"><i class="fas fa-bell"></i> Notifications</a></li>
				<li><button class="sign-out-btn" onclick="handleSignOut()"><i class="fas fa-sign-out-alt"></i> Sign Out</button></li>
			</ul>
		</div>
	</div>

	<div class="container">
		<div class="header">
			<h1>Verified Tutors</h1>
			<p>Browse through our certified and verified tutors ready to help you learn</p>
		</div>

		<div id="tutors-container">
			<div class="loading">Loading verified tutors...</div>
		</div>
	</div>

	<script>
			document.addEventListener('DOMContentLoaded', function() {
			
			const isLoggedIn = localStorage.getItem('loggedIn');
			const studentData = localStorage.getItem('studentData');

			if (!isLoggedIn) {
				alert('Please login first');
				window.location.href = 'login.html';
				return;
			}

			if (studentData) {
				try {
					const data = JSON.parse(studentData);
					if (data.full_name) {
						document.getElementById('displayName').textContent = data.full_name;
					}
				} catch (e) {
					console.error('Error parsing student data:', e);
				}
			}

			updateNotificationCount();
		});

		function showNotifications() {
			const notificationsSection = document.getElementById('notifications');
			notificationsSection.scrollIntoView({ behavior: 'smooth' });
		}

		function updateNotificationCount() {
			const unreadNotifications = document.querySelectorAll('.notification-item.unread').length;
			document.getElementById('notifCount').textContent = unreadNotifications;
		}

		function handleSignOut() {
			if (confirm('Are you sure you want to sign out?')) {
				localStorage.removeItem('loggedIn');
				localStorage.removeItem('studentData');
				localStorage.removeItem('userRole');
				
				window.location.href = 'logout.html';
			}
		}

		document.querySelectorAll('a[href="#notifications"]').forEach(link => {
			link.addEventListener('click', function(e) {
				e.preventDefault();
				showNotifications();
			});
		});
		(async function() {
			const API_BASE_URL = 'http://localhost:5000/api';
			const container = document.getElementById('tutors-container');

			try {
				console.log('Fetching verified tutors from:', `${API_BASE_URL}/tutor/verified`);
				
				const response = await fetch(`${API_BASE_URL}/tutor/verified`, {
					method: 'GET',
					headers: {
						'Content-Type': 'application/json',
						'Accept': 'application/json'
					},
					credentials: 'include'
				});

				console.log('Response status:', response.status, response.statusText);

				if (!response.ok) {
					const errorText = await response.text();
					console.error('Server error response:', errorText);
					
					let errorMessage = `Server error: ${response.status}`;
					if (errorText.includes('<!DOCTYPE')) {
						errorMessage = 'Server returned HTML instead of JSON. Check if backend is running correctly.';
					} else if (errorText) {
						try {
							const errorJson = JSON.parse(errorText);
							errorMessage = errorJson.error || errorJson.message || errorMessage;
						} catch (e) {
							errorMessage = errorText.substring(0, 100) || errorMessage;
						}
					}
					
					container.innerHTML = `
						<div class="empty-state">
							<h3>Error loading tutors</h3>
							<p>${errorMessage}</p>
						</div>
					`;
					return;
				}

				const contentType = response.headers.get('content-type');
				if (!contentType || !contentType.includes('application/json')) {
					const text = await response.text();
					console.error('Expected JSON but got:', text.substring(0, 200));
					container.innerHTML = `
						<div class="empty-state">
							<h3>Error loading tutors</h3>
							<p>Server returned non-JSON response. Check backend API.</p>
						</div>
					`;
					return;
				}

				const data = await response.json();
				console.log('Received data:', data);

				const tutors = data.tutors || [];

				if (tutors.length === 0) {
					container.innerHTML = `
						<div class="empty-state">
							<h3>No verified tutors yet</h3>
							<p>Check back later for verified tutors</p>
						</div>
					`;
					return;
				}

				displayTutors(tutors);

			} catch (error) {
				console.error('Error fetching tutors:', error);
				
				let errorMessage = 'Network error. Please check your connection and ensure the server is running.';
				
				if (error.message.includes('Failed to fetch')) {
					errorMessage = 'Cannot connect to server. Make sure your backend is running on localhost:5000.';
				} else if (error.message.includes('HTML instead of JSON')) {
					errorMessage = 'Server returned an error page. Check if the API endpoint is correct.';
				} else {
					errorMessage = error.message;
				}

				container.innerHTML = `
					<div class="empty-state">
						<h3>Error loading tutors</h3>
						<p>${errorMessage}</p>
						<p style="margin-top: 20px; font-size: 0.9rem; color: #888;">
							Troubleshooting tips:<br>
							• Ensure backend server is running<br>
							• Check console for detailed errors<br>
							• Verify API endpoint URL
						</p>
					</div>
				`;
			}
		})();

		function displayTutors(tutors) {
			const container = document.getElementById('tutors-container');
			container.innerHTML = '<div class="tutors-grid" id="tutors-grid"></div>';
			const grid = document.getElementById('tutors-grid');

			tutors.forEach(tutor => {
				const card = document.createElement('div');
				card.className = 'tutor-card';
				
				const availabilityClass = tutor.is_available ? 'available' : 'unavailable';
				const availabilityText = tutor.is_available ? 'Available' : 'Not Available';
				
				card.innerHTML = `
					<div class="tutor-header">
						<h3>${tutor.name || tutor.full_name || 'Unknown'}</h3>
						<div class="subject">Subject: ${tutor.subject || 'N/A'}</div>
						<span class="verified-badge">✓ Verified</span>
					</div>
					<div class="tutor-body">
						<div class="info-row">
							<span class="info-label">Education:</span>
							<span class="info-value">${tutor.education_level || 'N/A'}</span>
						</div>
						<div class="info-row">
							<span class="info-label">Experience:</span>
							<span class="info-value">${tutor.experience_years || 0} years</span>
						</div>
						<div class="info-row">
							<span class="info-label">Hourly Rate:</span>
							<span class="info-value"><span class="rate-highlight">NPR ${tutor.hourly_rate || 'N/A'}</span>/hr</span>
						</div>
						<div class="info-row">
							<span class="info-label">Mode:</span>
							<span class="info-value">${tutor.teaching_mode || 'N/A'}</span>
						</div>
						<div class="info-row">
							<span class="info-label">Location:</span>
							<span class="info-value">${tutor.location || 'N/A'}</span>
						</div>
						<div class="info-row">
							<span class="info-label">Status:</span>
							<span class="info-value"><span class="availability ${availabilityClass}">${availabilityText}</span></span>
						</div>
					</div>
				`;
				
				grid.appendChild(card);
			});
		}
	</script>
</body>
</html>

