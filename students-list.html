<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Students List</title>
  <link rel="stylesheet" href="./assets/style.css" />
  <style>
    .wrap{ padding:110px 20px 40px; max-width:1200px; margin:0 auto; }
    .cards-grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
    .card.small{ height:auto; width:auto; align-items:flex-start; }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80" /></a>
    <div class="nav"><ul class="list">
      <li><a href="tutor-dashboard.html" class="nb">Dashboard</a></li>
      <li><a href="students-list.html" class="nb">Find Students</a></li>
      <li><a href="aboutus.html" class="nb">About us</a></li>
      <li><a href="logout.html" class="nb">Logout</a></li>
    </ul></div>
  </nav>

  <div class="wrap">
    <h1>Students</h1>
    <div id="list" class="cards-grid"></div>
  </div>

  <script>
    const API = 'http://localhost:5000/api';

    async function fetchMe(){
      const token = localStorage.getItem('authToken');
      const r = await fetch(API + '/auth/me', {
        credentials:'include',
        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
      });
      if(!r.ok) { location.href = 'login.html'; return null; }
      const data = await r.json(); return data.user;
    }

    function studentCard(s){
      const subs = Array.isArray(s.subjects) ? s.subjects.join(', ') : (s.subjects || '-');
      return `
        <div class="card small">
          <h3>${s.full_name || 'Student'}</h3>
          <p><b>Subjects:</b> ${subs}</p>
          <p><b>Mode:</b> ${s.preferred_mode || '-'}</p>
          <p><b>Budget:</b> ${s.budget || '-'}</p>
        </div>
      `;
    }

    async function render(){
      const container = document.getElementById('list');
      const res = await fetch(API + '/student/all');
      const data = await res.json();
      const students = (data && data.students) || [];
      container.innerHTML = students.map(studentCard).join('');
    }

    (async function init(){
      const me = await fetchMe();
      if(!me || me.role !== 'tutor'){ alert('Login as tutor required'); location.href='login.html'; return; }
      await render();
    })();
  </script>
</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Students List</title>
  <link rel="stylesheet" href="./assets/style.css" />
  <style>
    .wrap{ padding:110px 20px 40px; max-width:1200px; margin:0 auto; }
    
    /* Added registered tutor section styles */
    .tutor-section{
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 32px;
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    .tutor-info h2{ margin: 0 0 8px 0; font-size: 24px; }
    .tutor-details{ display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-top: 12px; }
    .detail-item{ background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px; }
    .detail-label{ font-size: 12px; opacity: 0.9; text-transform: uppercase; }
    .detail-value{ font-size: 16px; font-weight: 600; margin-top: 4px; }
    
    /* Added search bar styles */
    .search-section{ margin-bottom: 24px; }
    .search-input{
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    .search-input:focus{
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .search-results-info{
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }
    
    .cards-grid{ display:grid; grid-template-columns: repeat(auto-fill,minmax(280px,1fr)); gap:16px; }
    .card.small{ height:auto; width:auto; align-items:flex-start; }
    .no-results{
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px 20px;
      color: #999;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="index.html" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80" /></a>
    <div class="nav"><ul class="list">
      <li><a href="tutor-dashboard.html" class="nb">Dashboard</a></li>
      <li><a href="students-list.html" class="nb">Find Students</a></li>
      <li><a href="logout.html" class="nb">Logout</a></li>
    </ul></div>
  </nav>

  <div class="wrap">
    <div class="tutor-section" id="tutorSection" style="display:none;">
      <div class="tutor-info">
        <h2 id="tutorName">Welcome, Tutor</h2>
        <div class="tutor-details">
          <div class="detail-item">
            <div class="detail-label">Expertise</div>
            <div class="detail-value" id="tutorSubjects">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Teaching Mode</div>
            <div class="detail-value" id="tutorMode">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Experience</div>
            <div class="detail-value" id="tutorExperience">-</div>
          </div>
        </div>
      </div>
    </div>

    <div class="search-section">
      <input
        type="text"
        class="search-input"
        id="searchInput"
        placeholder="Search students by name, subjects, or budget..."
      />
      <div class="search-results-info" id="resultsInfo"></div>
    </div>

    <h1>Available Students</h1>
    <div id="list" class="cards-grid"></div>
  </div>

  <script>
    const API = 'http://localhost:5000/api';
    let allStudents = [];

    async function fetchMe(){
      const token = localStorage.getItem('authToken');
      const r = await fetch(API + '/auth/me', {
        credentials:'include',
        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
      });
      if(!r.ok) { location.href = 'login.html'; return null; }
      const data = await r.json(); 
      return data.user;
    }

    function studentCard(s){
      const subs = Array.isArray(s.subjects) ? s.subjects.join(', ') : (s.subjects || '-');
      return `
        <div class="card small">
          <h3>${s.full_name || 'Student'}</h3>
          <p><b>Subjects:</b> ${subs}</p>
          <p><b>Mode:</b> ${s.preferred_mode || '-'}</p>
          <p><b>Budget:</b> ${s.budget || '-'}</p>
        </div>
      `;
    }

    function displayTutorInfo(tutor) {
      const tutorSection = document.getElementById('tutorSection');
      const subjectsArray = Array.isArray(tutor.subjects) ? tutor.subjects.join(', ') : (tutor.subjects || '-');
      
      document.getElementById('tutorName').textContent = `Welcome, ${tutor.full_name || 'Tutor'}`;
      document.getElementById('tutorSubjects').textContent = subjectsArray;
      document.getElementById('tutorMode').textContent = tutor.preferred_mode || '-';
      document.getElementById('tutorExperience').textContent = tutor.experience || '-';
      
      tutorSection.style.display = 'block';
    }

    function filterStudents(query) {
      const searchTerm = query.toLowerCase();
      
      const filtered = allStudents.filter(student => {
        const name = (student.full_name || '').toLowerCase();
        const subjects = Array.isArray(student.subjects) 
          ? student.subjects.join(', ').toLowerCase() 
          : (student.subjects || '').toLowerCase();
        const budget = (student.budget || '').toString().toLowerCase();
        const mode = (student.preferred_mode || '').toLowerCase();
        
        return name.includes(searchTerm) || 
               subjects.includes(searchTerm) || 
               budget.includes(searchTerm) || 
               mode.includes(searchTerm);
      });

      const container = document.getElementById('list');
      const resultsInfo = document.getElementById('resultsInfo');

      if (filtered.length === 0 && searchTerm) {
        container.innerHTML = '<div class="no-results">No students found matching your search.</div>';
        resultsInfo.textContent = `0 results found for "${query}"`;
      } else if (filtered.length === 0) {
        container.innerHTML = '<div class="no-results">No students available.</div>';
        resultsInfo.textContent = '';
      } else {
        container.innerHTML = filtered.map(studentCard).join('');
        resultsInfo.textContent = `Showing ${filtered.length} of ${allStudents.length} students`;
      }
    }

    async function render(){
      const res = await fetch(API + '/student/all');
      const data = await res.json();
      allStudents = (data && data.students) || [];
      filterStudents('');
    }

    (async function init(){
      const me = await fetchMe();
      if(!me || me.role !== 'tutor'){ 
        alert('Login as tutor required'); 
        location.href='login.html'; 
        return; 
      }
      
      displayTutorInfo(me);
      await render();

      document.getElementById('searchInput').addEventListener('input', (e) => {
        filterStudents(e.target.value);
      });
    })();
  </script>
</body>
</html>
