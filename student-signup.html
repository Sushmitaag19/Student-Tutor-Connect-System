<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./assets/style.css">
	<title>Student Sign Up</title>
	
	<style>

		* {
		  margin: 0;
		  padding: 0;
		  box-sizing: border-box;
		}

		body {
		  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
		  background: var(--body);
		  min-height: 100vh;
		  display: flex;
		  flex-direction: column;
		}

		.form-container {
			margin-top: 100px;
		  flex: 1;
		  display: flex;
		  justify-content: center;
		  align-items: center;
		  padding: 2rem;
		}

		.form-wrapper {
		  background: white;
		  padding: 3rem;
		  border-radius: 12px;
		  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
		  width: 100%;
		  max-width: 500px;
		}

		.form-wrapper h2 {
		  font-size: 2.5rem;
		  color: var(--logo);
		  text-align: center;
		  margin-bottom: 2rem;
		  font-weight: 600;
		}

		.form-group {
		  margin-bottom: 1.5rem;
		  display: flex;
		  flex-direction: column;
		}

		.form-group label {
		  font-size: 1.1rem;
		  color: #333;
		  margin-bottom: 0.5rem;
		  font-weight: 500;
		}

		.form-group input,
		.form-group select {
		  padding: 0.75rem 1rem;
		  font-size: 1rem;
		  border: 2px solid #e0e0e0;
		  border-radius: 6px;
		  transition: all 0.3s ease;
		  font-family: inherit;
		}
		.form-group select {
			height: 50px;
		}
		.form-group input:focus,
		.form-group select:focus {
		  outline: none;
		  border-color: var(--logo);
		  box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
		  background-color: #f8fbff;
		}

		.form-group select {
		  background-color: white;
		  color: #333;
		  cursor: pointer;
		}

		.error {
		  color: #c0392b;
		  font-size: 0.85rem;
		  margin-top: 0.3rem;
		  min-height: 1.2rem;
		}

		.checkbox-group {
		  flex-direction: row;
		  align-items: flex-start;
		  margin-bottom: 2rem;
		}

		.checkbox-label {
		  display: flex;
		  align-items: center;
		  gap: 0.75rem;
		  font-size: 1rem;
		  font-weight: normal;
		  cursor: pointer;
		}

		.checkbox-label input[type="checkbox"] {
		  width: 20px;
		  height: 20px;
		  cursor: pointer;
		  margin: 0;
		  padding: 0;
		}

		.checkbox-label a {
		  color: var(--logo);
		  text-decoration: none;
		  transition: color 0.3s ease;
		}

		.checkbox-label a:hover {
		  color: var(--logo);
		  text-decoration: underline;
		}

		.submit-btn {
		  width: 100%;
		  padding: 0.9rem 1.5rem;
		  font-size: 1.1rem;
		  background-color: var(--logo);
		  color: black;
		  border: none;
		  border-radius: 6px;
		  cursor: pointer;
		  font-weight: 600;
		  transition: all 0.3s ease;
		}

		.submit-btn:hover {
		  background-color: var(--logo);
		  transform: translateY(-2px);
		  box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
		}

		.submit-btn:active {
		  transform: translateY(0);
		}

		@media (max-width: 768px) {
		  .navbar {
		    flex-direction: column;
		    gap: 1rem;
		  }

		  .nav ul {
		    flex-wrap: wrap;
		    justify-content: center;
		    gap: 1rem;
		  }

		  .form-container {
		    padding: 1rem;
		  }

		  .form-wrapper {
		    padding: 2rem;
		  }

		  .form-wrapper h2 {
		    font-size: 2rem;
		  }

		  .form-group label {
		    font-size: 1rem;
		  }

		  .form-group input,
		  .form-group select {
		    font-size: 0.95rem;
		  }
		}

		@media (max-width: 480px) {
		  .form-wrapper {
		    padding: 1.5rem;
		  }

		  .form-wrapper h2 {
		    font-size: 1.75rem;
		    margin-bottom: 1.5rem;
		  }

		  .form-group {
		    margin-bottom: 1.2rem;
		  }

		  .form-group label {
		    font-size: 0.95rem;
		  }

		  .form-group input,
		  .form-group select {
		    font-size: 0.9rem;
		    padding: 0.65rem 0.85rem;
		  }

		  .submit-btn {
		    font-size: 1rem;
		    padding: 0.8rem 1rem;
		  }
		}
	</style>
</head>
<body>
	<nav class="navbar">
		<a href="index.html" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80px" width="auto"></a>
		<div class="nav">
			<ul class="list">
				<li><a href="aboutus.html" class="nb">About us</a></li>
				<li><a href="tutor.html" class="nb">Find a tutor</a></li>
				<li><a href="becomeTutor.html" class="nb">Become a tutor</a></li>
				<li><a href="login.html"><button type="button">Login</button></a></li>
				<li><a href="register.html"><button type="button">Sign in</button></a></li>
			</ul>
		</div>
	</nav>

	<div class="form-container">
		<div class="form-wrapper">
			<h2>Student Sign Up</h2>
			<form class="form" id="studentForm" novalidate>
				<div class="form-group">
					<label for="s-name">Full Name:</label>
					<input type="text" name="name" id="s-name" required>
					<div class="error" id="err-s-name"></div>
				</div>

				<div class="form-group">
					<label for="s-email">Email:</label>
					<input type="email" name="email" id="s-email" required>
					<div class="error" id="err-s-email"></div>
				</div>

				<div class="form-group">
					<label for="s-pass">Password:</label>
					<input type="password" name="password" id="s-pass" required minlength="6">
					<div class="error" id="err-s-pass"></div>
				</div>

				<div class="form-group">
					<label for="s-level">Educational Level:</label>
					<select name="level" id="s-level" required>
						<option value="">Select level</option>
						<option value="Primary Class">Primary Class</option>
						<option value="Lower Secondary Class">Lower Secondary Class</option>
						<option value="+2">+2</option>
						<option value="Bachelors">Bachelors</option>
						<option value="Masters">Masters</option>
					</select>
					<div class="error" id="err-s-level"></div>
				</div>

				<div class="form-group">
					<label for="s-subject">Preferred Subject:</label>
					<select name="subject" id="s-subject" required>
						<option value="">Select subject</option>
						<option value="Math">Math</option>
						<option value="Physics">Physics</option>
						<option value="English">English</option>
						<option value="Computer Science">Computer Science</option>
						<option value="Chemistry">Chemistry</option>
						<option value="Biology">Biology</option>
						<option value="Nepali">Nepali</option>
					</select>
					<div class="error" id="err-s-subject"></div>
				</div>

				<div class="form-group">
					<label for="s-mode">Mode:</label>
					<select name="mode" id="s-mode" required>
						<option value="">Select mode</option>
						<option value="Online">Online</option>
						<option value="Offline">Offline</option>
						<option value="Hybrid">Hybrid</option>
					</select>
					<div class="error" id="err-s-mode"></div>
				</div>

				<div class="form-group">
					<label for="s-location">Location (City):</label>
					<input type="text" name="location" id="s-location" required>
					<div class="error" id="err-s-location"></div>
				</div>

				<div class="form-group">
					<label for="s-budget">Budget (NPR/hr):</label>
					<input type="number" name="budget" id="s-budget" min="0" step="100" required>
					<div class="error" id="err-s-budget"></div>
				</div>

				<div class="form-group checkbox-group">
					<label for="s-terms" class="checkbox-label">
						<input type="checkbox" id="s-terms" required>
						<span>I agree to the <a href="terms.html" target="_blank">Terms and Conditions</a></span>
					</label>
					<div class="error" id="err-s-terms"></div>
				</div>

				<button type="submit" class="submit-btn">Create account</button>
			</form>
		</div>
	</div>

	<script>
		(async () => {
		  const API_BASE_URL = 'http://localhost:5000/api';
		  
		  function setError(id, msg) {
		    document.getElementById(id).textContent = msg || ""
		  }

		  function emailOk(v) {
		    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)
		  }

		  document.getElementById("studentForm").addEventListener("submit", async (e) => {
		    e.preventDefault();
		    
		    let ok = true
		    const name = document.getElementById("s-name").value.trim()
		    const email = document.getElementById("s-email").value.trim()
		    const pass = document.getElementById("s-pass").value
		    const level = document.getElementById("s-level").value
		    const subject = document.getElementById("s-subject").value
		    const mode = document.getElementById("s-mode").value
		    const location = document.getElementById("s-location").value.trim()
		    const budget = document.getElementById("s-budget").value
		    const terms = document.getElementById("s-terms").checked

		    setError("err-s-name")
		    setError("err-s-email")
		    setError("err-s-pass")
		    setError("err-s-level")
		    setError("err-s-subject")
		    setError("err-s-mode")
		    setError("err-s-location")
		    setError("err-s-budget")
		    setError("err-s-terms")

		    // Validation
		    if (name.length < 2) {
		      setError("err-s-name", "Please enter your full name.")
		      ok = false
		    }
		    if (!emailOk(email)) {
		      setError("err-s-email", "Enter a valid email address.")
		      ok = false
		    }
		    if (pass.length < 6) {
		      setError("err-s-pass", "Password must be at least 6 characters.")
		      ok = false
		    }
		    if (!level) {
		      setError("err-s-level", "Select your level.")
		      ok = false
		    }
		    if (!subject) {
		      setError("err-s-subject", "Select a subject.")
		      ok = false
		    }
		    if (!mode) {
		      setError("err-s-mode", "Select a mode.")
		      ok = false
		    }
		    if (location.length < 2) {
		      setError("err-s-location", "Enter your city.")
		      ok = false
		    }
		    if (budget === "" || Number(budget) < 0) {
		      setError("err-s-budget", "Enter a valid budget.")
		      ok = false
		    }
		    if (!terms) {
		      setError("err-s-terms", "You must agree to the Terms and Conditions.")
		      ok = false
		    }

		    if (!ok) return;

		    // Try backend first, fallback to localStorage
		    try {
		      const registerData = {
		        full_name: name,
		        email: email,
		        password: pass,
		        role: 'student'
		      };

		      const registerResponse = await fetch(`${API_BASE_URL}/auth/register`, {
		        method: 'POST',
		        headers: {
		          'Content-Type': 'application/json'
		        },
		        body: JSON.stringify(registerData)
		      });

		      const registerResult = await registerResponse.json();

		      if (registerResponse.ok) {
		        const userId = registerResult.user.user_id;

		        // Create student profile
		        try {
		          const studentProfileData = {
		            user_id: userId,
		            academic_level: level,
		            preferred_mode: mode.toLowerCase(),
		            budget: Number(budget),
		            availability: location
		          };

		          const profileResponse = await fetch(`${API_BASE_URL}/student/profile`, {
		            method: 'POST',
		            headers: {
		              'Content-Type': 'application/json'
		            },
		            body: JSON.stringify(studentProfileData)
		          });
		        } catch (profileError) {
		          console.log('Profile creation failed, but continuing...');
		        }
		      }
		    } catch (apiError) {
		      console.log('Backend not available, using local storage mode');
		    }

		    // Store user data (works with or without backend)
		    localStorage.setItem('loggedIn', 'true');
		    localStorage.setItem('userRole', 'student');
		    localStorage.setItem('studentData', JSON.stringify({
		      user_id: registerResult?.user?.user_id || Date.now(),
		      full_name: name,
		      email: email,
		      password: pass,
		      role: 'student'
		    }));

		    window.location.href = 'student-dashboard.html';
		  })
		})()
	</script>
</body>
</html>
