<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="./assets/style.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<title>Student Dashboard</title>
	<style>
		.dashboard-container {
			padding-top: 100px;
			min-height: 100vh;
			background-color: var(--body);
		}

		.dashboard-nav {
			background: linear-gradient(135deg, var(--slider) 0%, var(--accent) 100%);
			padding: 1.5rem 2rem;
			color: white;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}

		.dashboard-nav h2 {
			margin: 0;
			font-size: 1.5rem;
			font-weight: 600;
		}

		.dashboard-nav .user-info {
			display: flex;
			align-items: center;
			gap: 1rem;
		}

		.dashboard-nav .username {
			font-size: 1.1rem;
			font-weight: 500;
		}

		.dashboard-nav ul {
			list-style: none;
			display: flex;
			gap: 2rem;
			align-items: center;
			margin: 0;
			padding: 0;
		}

		.dashboard-nav ul li a {
			color: white;
			text-decoration: none;
			font-size: 1.1rem;
			padding: 0.5rem 1rem;
			border-radius: 6px;
			transition: all 0.3s ease;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.dashboard-nav ul li a:hover {
			background-color: rgba(255,255,255,0.2);
			transform: translateY(-2px);
		}

		.sign-out-btn {
			background-color: #dc3545;
			padding: 0.6rem 1.2rem;
			border-radius: 6px;
			border: none;
			color: white;
			cursor: pointer;
			font-size: 1rem;
			transition: all 0.3s ease;
		}

		.sign-out-btn:hover {
			background-color: #c82333;
			transform: translateY(-2px);
		}

		.dashboard-content {
			padding: 2rem;
			max-width: 1200px;
			margin: 0 auto;
		}

		.welcome-section {
			background: white;
			padding: 2rem;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			margin-bottom: 2rem;
		}

		.welcome-section h1 {
			color: var(--accent);
			font-size: 2rem;
			margin-bottom: 0.5rem;
		}

		.welcome-section p {
			color: #666;
			font-size: 1.1rem;
		}

		.section {
			background: white;
			padding: 2rem;
			border-radius: 12px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			margin-bottom: 2rem;
		}

		.section h2 {
			color: var(--slider);
			font-size: 1.8rem;
			margin-bottom: 1.5rem;
			display: flex;
			align-items: center;
			gap: 0.5rem;
		}

		.notification-item {
			padding: 1rem;
			border-left: 4px solid var(--logo);
			margin-bottom: 1rem;
			background-color: #f8f9fa;
			border-radius: 6px;
			transition: all 0.3s ease;
		}

		.notification-item:hover {
			background-color: #e9ecef;
			transform: translateX(5px);
		}

		.notification-item.unread {
			background-color: #fff3cd;
			border-left-color: #ffc107;
		}

		.notification-item h3 {
			color: var(--slider);
			font-size: 1.2rem;
			margin-bottom: 0.5rem;
		}

		.notification-item p {
			color: #666;
			margin: 0;
		}

		.notification-item .timestamp {
			font-size: 0.85rem;
			color: #999;
			margin-top: 0.5rem;
		}

		.stats-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
			gap: 1.5rem;
			margin-top: 1rem;
		}

		.stat-card {
			background: linear-gradient(135deg, var(--logo) 0%, #ffd700 100%);
			padding: 1.5rem;
			border-radius: 12px;
			color: #333;
			text-align: center;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			transition: transform 0.3s ease;
		}

		.stat-card:hover {
			transform: translateY(-5px);
		}

		.stat-card h3 {
			font-size: 2rem;
			margin: 0;
			font-weight: bold;
		}

		.stat-card p {
			margin: 0.5rem 0 0 0;
			font-size: 1rem;
			opacity: 0.9;
		}

		.quick-actions {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 1rem;
			margin-top: 1rem;
		}

		.action-btn {
			padding: 1.5rem;
			background-color: var(--slider);
			color: white;
			text-align: center;
			text-decoration: none;
			border-radius: 12px;
			transition: all 0.3s ease;
			font-size: 1.1rem;
			font-weight: 600;
		}

		.action-btn:hover {
			background-color: var(--accent);
			transform: translateY(-3px);
			box-shadow: 0 6px 20px rgba(0,0,0,0.15);
		}

		@media (max-width: 768px) {
			.dashboard-nav {
				flex-direction: column;
				gap: 1rem;
			}

			.dashboard-nav ul {
				flex-wrap: wrap;
				gap: 1rem;
			}

			.dashboard-content {
				padding: 1rem;
			}

			.welcome-section h1 {
				font-size: 1.5rem;
			}

			.stats-grid {
				grid-template-columns: 1fr;
			}
		}
	</style>
</head>
<body>
	<div class="dashboard-nav">
		<a href="#" class="Logo"><img src="./assets/images/pill-logo.png" alt="Logo" height="80px" width="auto"></a>
        
		<div class="user-info">
			<span class="username" id="displayName">Student</span>
			<ul>
				<li><a href="./verified-tutors.html"><i class="fas fa-search"></i> Find Tutor</a></li>
				<li><a href="#notifications" onclick="showNotifications()"><i class="fas fa-bell"></i> Notifications</a></li>
				<li><button class="sign-out-btn" onclick="handleSignOut()"><i class="fas fa-sign-out-alt"></i> Sign Out</button></li>
			</ul>
		</div>
	</div>

	<div class="dashboard-container">
		<div class="dashboard-content">
			<div class="welcome-section">
				<h1><i class="fas fa-user-graduate"></i> Welcome Back!</h1>
				<p>Find your perfect tutor and start learning today</p>
			</div>

			<div class="section">
				<h2><i class="fas fa-chart-line"></i> Your Statistics</h2>
				<div class="stats-grid">
					<div class="stat-card">
						<h3 id="tutorCount">0</h3>
						<p>Available Tutors</p>
					</div>
					<div class="stat-card">
						<h3 id="msgCount">0</h3>
						<p>New Messages</p>
					</div>
					<div class="stat-card">
						<h3 id="notifCount">3</h3>
						<p>Notifications</p>
					</div>
				</div>
			</div>

			<div class="section">
				<h2><i class="fas fa-bolt"></i> Quick Actions</h2>
				<div class="quick-actions">
					<a href="tutor.html" class="action-btn">
						<i class="fas fa-search"></i><br>Search Tutors
					</a>
					<a href="#notifications" class="action-btn" onclick="showNotifications()">
						<i class="fas fa-bell"></i><br>View Notifications
					</a>
					<a href="aboutus.html" class="action-btn">
						<i class="fas fa-info-circle"></i><br>About Us
					</a>
				</div>
			</div>

			<!-- Notifications Section -->
			<div class="section" id="notifications">
				<h2><i class="fas fa-bell"></i> Notifications</h2>
				<div id="notificationsList">
					<div class="notification-item unread">
						<h3><i class="fas fa-check-circle"></i> New Tutor Available</h3>
						<p>Great news! A Math tutor matching your preferences has joined the platform.</p>
						<span class="timestamp">2 hours ago</span>
					</div>
					<div class="notification-item unread">
						<h3><i class="fas fa-star"></i> Profile Update</h3>
						<p>Don't forget to complete your profile to get better tutor recommendations.</p>
						<span class="timestamp">1 day ago</span>
					</div>
					<div class="notification-item">
						<h3><i class="fas fa-info-circle"></i> System Maintenance</h3>
						<p>Scheduled maintenance on Sunday from 2:00 AM to 4:00 AM. Service will be temporarily unavailable.</p>
						<span class="timestamp">3 days ago</span>
					</div>
				</div>
			</div>

			<!-- Feedback Section -->
			<div class="section" id="feedback">
				<h2><i class="fas fa-comment-dots"></i> Submit Feedback</h2>
				<form id="feedbackForm">
					<div style="margin-bottom: 1rem;">
						<label for="tutorSelect" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Select Tutor:</label>
						<select id="tutorSelect" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;">
							<option value="">Choose a tutor...</option>
						</select>
					</div>
					<div style="margin-bottom: 1rem;">
						<label for="feedbackScore" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Rating (1-5):</label>
						<select id="feedbackScore" style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem;">
							<option value="">Select rating...</option>
							<option value="5">5 - Excellent</option>
							<option value="4">4 - Very Good</option>
							<option value="3">3 - Good</option>
							<option value="2">2 - Fair</option>
							<option value="1">1 - Poor</option>
						</select>
					</div>
					<div style="margin-bottom: 1rem;">
						<label for="feedbackText" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Review:</label>
						<textarea id="feedbackText" rows="4" placeholder="Share your experience with this tutor..." style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 6px; font-size: 1rem; resize: vertical;"></textarea>
					</div>
					<button type="submit" style="background-color: var(--slider); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s ease;">
						<i class="fas fa-paper-plane"></i> Submit Feedback
					</button>
				</form>
				<div id="feedbackMessage" style="margin-top: 1rem; padding: 1rem; border-radius: 6px; display: none;"></div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', function() {
			
			const isLoggedIn = localStorage.getItem('loggedIn');
			const studentData = localStorage.getItem('studentData');

			if (!isLoggedIn) {
				alert('Please login first');
				window.location.href = 'login.html';
				return;
			}

			if (studentData) {
				try {
					const data = JSON.parse(studentData);
					if (data.full_name) {
						document.getElementById('displayName').textContent = data.full_name;
					}
				} catch (e) {
					console.error('Error parsing student data:', e);
				}
			}

			updateNotificationCount();
		});

		function showNotifications() {
			const notificationsSection = document.getElementById('notifications');
			notificationsSection.scrollIntoView({ behavior: 'smooth' });
		}

		function updateNotificationCount() {
			const unreadNotifications = document.querySelectorAll('.notification-item.unread').length;
			document.getElementById('notifCount').textContent = unreadNotifications;
		}

		function handleSignOut() {
			if (confirm('Are you sure you want to sign out?')) {
				localStorage.removeItem('loggedIn');
				localStorage.removeItem('studentData');
				localStorage.removeItem('userRole');
				
				window.location.href = 'logout.html';
			}
		}

		document.querySelectorAll('a[href="#notifications"]').forEach(link => {
			link.addEventListener('click', function(e) {
				e.preventDefault();
				showNotifications();
			});
		});

		// Feedback form functionality
		async function loadTutorsForFeedback() {
			try {
				const response = await fetch('/api/tutor/verified');
				const data = await response.json();
				const tutorSelect = document.getElementById('tutorSelect');
				
				if (data.tutors && data.tutors.length > 0) {
					data.tutors.forEach(tutor => {
						const option = document.createElement('option');
						option.value = tutor.tutor_id;
						option.textContent = `${tutor.full_name} - ${tutor.subjects_taught?.join(', ') || 'Various Subjects'}`;
						tutorSelect.appendChild(option);
					});
				}
			} catch (error) {
				console.error('Error loading tutors for feedback:', error);
			}
		}

		// Handle feedback form submission
		document.getElementById('feedbackForm').addEventListener('submit', async function(e) {
			e.preventDefault();
			
			const tutorId = document.getElementById('tutorSelect').value;
			const score = document.getElementById('feedbackScore').value;
			const review = document.getElementById('feedbackText').value;
			const messageDiv = document.getElementById('feedbackMessage');
			
			if (!tutorId || !score) {
				messageDiv.style.display = 'block';
				messageDiv.style.backgroundColor = '#f8d7da';
				messageDiv.style.color = '#721c24';
				messageDiv.style.border = '1px solid #f5c6cb';
				messageDiv.textContent = 'Please select a tutor and rating.';
				return;
			}
			
			try {
				const response = await fetch('/api/feedback', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						tutor_id: tutorId,
						feedback_score: parseInt(score),
						review: review
					})
				});
				
				const data = await response.json();
				
				if (response.ok) {
					messageDiv.style.display = 'block';
					messageDiv.style.backgroundColor = '#d4edda';
					messageDiv.style.color = '#155724';
					messageDiv.style.border = '1px solid #c3e6cb';
					messageDiv.textContent = 'Feedback submitted successfully!';
					
					// Reset form
					document.getElementById('feedbackForm').reset();
				} else {
					messageDiv.style.display = 'block';
					messageDiv.style.backgroundColor = '#f8d7da';
					messageDiv.style.color = '#721c24';
					messageDiv.style.border = '1px solid #f5c6cb';
					messageDiv.textContent = data.error || 'Error submitting feedback.';
				}
			} catch (error) {
				console.error('Error submitting feedback:', error);
				messageDiv.style.display = 'block';
				messageDiv.style.backgroundColor = '#f8d7da';
				messageDiv.style.color = '#721c24';
				messageDiv.style.border = '1px solid #f5c6cb';
				messageDiv.textContent = 'Network error. Please try again.';
			}
		});

		// Load tutors when page loads
		loadTutorsForFeedback();
	</script>
</body>
</html>